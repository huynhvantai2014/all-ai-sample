# 画面定義書
## 社員詳細画面 (Employee Detail Screen)

### 画面ID: SRC0003
### 最終更新日: 2025年10月30日

---

## 1. 画面概要

### 1.1 画面名
**社員詳細画面 (Employee Detail)**

### 1.2 機能概要
個別社員の詳細情報を表示。基本情報、スキル、プロジェクト履歴等を包括的に確認可能。編集・削除機能への導線も提供。

### 1.3 画面種別
- **詳細表示画面**
- **読み取り専用**

### 1.4 アクセス権限
- **管理者 (admin)**: 全機能利用可能
- **マネージャー (manager)**: 閲覧・編集可能
- **一般ユーザー (user)**: 制限付き閲覧

---

## 2. 画面レイアウト

### 2.1 画面構成
```
┌─────────────────────────────────────────────────┐
│ ヘッダー: 社員詳細 + ナビゲーション              │
├─────────────────────────────────────────────────┤
│ パンくずリスト                                  │
│ ホーム > 社員一覧 > 田中太郎                    │
├─────────────────────────────────────────────────┤
│ 社員情報ヘッダー                                │
│ ┌─────────────────────────────────────────┐     │
│ │ 田中太郎 (EMP001)          [編集] [削除]│     │
│ │ 開発部 エンジニア                      │     │
│ │ ● 稼働中                              │     │
│ └─────────────────────────────────────────┘     │
├─────────────────────────────────────────────────┤
│ 基本情報セクション                              │
│ ┌─────────────────────────────────────────┐     │
│ │ 社員ID      : EMP001                   │     │
│ │ メール      : tanaka@example.com       │     │
│ │ 電話番号    : 090-1234-5678            │     │
│ │ 入社日      : 2023年4月1日             │     │
│ │ 更新日時    : 2025年10月30日 12:00     │     │
│ └─────────────────────────────────────────┘     │
├─────────────────────────────────────────────────┤
│ スキル・専門性セクション                        │
│ ┌─────────────────────────────────────────┐     │
│ │ [JavaScript] [Python] [React] [Node.js]│     │
│ │ [TypeScript] [MongoDB] [AWS]           │     │
│ └─────────────────────────────────────────┘     │
├─────────────────────────────────────────────────┤
│ アクション                                      │
│ [戻る] [編集] [削除]                            │
└─────────────────────────────────────────────────┘
```

### 2.2 レスポンシブデザイン
- **デスクトップ**: 2カラムレイアウト（情報 + アクション）
- **タブレット**: 1カラムレイアウト
- **モバイル**: 縦積みレイアウト、スクロール対応

---

## 3. 画面要素定義

### 3.1 ヘッダー部
| 要素名            | 種別         | 表示内容              | 動作                    |
|-------------------|--------------|----------------------|-------------------------|
| ページタイトル    | Typography   | "社員詳細"            | なし                    |
| パンくずリスト    | Breadcrumbs  | ナビゲーションパス    | 各階層へのリンク        |

### 3.2 社員情報ヘッダー
| 要素名            | 種別         | 表示内容              | 動作                    |
|-------------------|--------------|----------------------|-------------------------|
| 社員名            | Typography   | full_name             | なし                    |
| 社員ID            | Typography   | employee_id (括弧内)  | なし                    |
| 部門・役職        | Typography   | department + position | なし                    |
| ステータス        | Chip         | status（色分け）      | なし                    |
| 編集ボタン        | Button       | "編集"                | 編集画面遷移            |
| 削除ボタン        | Button       | "削除"                | 削除確認ダイアログ表示  |

### 3.3 基本情報セクション
| 項目名            | 種別         | 表示形式              | 備考                    |
|-------------------|--------------|----------------------|-------------------------|
| 社員ID            | Typography   | employee_id          | 変更不可                |
| メールアドレス    | Typography   | email（リンク形式）   | mailto:リンク          |
| 電話番号          | Typography   | phone（リンク形式）   | tel:リンク             |
| 入社日            | Typography   | YYYY年MM月DD日        | 日付フォーマット        |
| 最終更新日時      | Typography   | YYYY年MM月DD日 HH:MM  | タイムスタンプ          |

### 3.4 スキル・専門性セクション
| 要素名            | 種別         | 表示形式              | 動作                    |
|-------------------|--------------|----------------------|-------------------------|
| スキルタグ        | Chip         | skill配列要素         | クリックで検索画面遷移  |
| スキル追加        | Button       | "+"（管理者のみ）     | スキル追加モーダル      |

### 3.5 アクションエリア
| 要素名            | 種別         | 表示内容              | 権限                    |
|-------------------|--------------|----------------------|-------------------------|
| 戻るボタン        | Button       | "戻る"                | 全ユーザー              |
| 編集ボタン        | Button       | "編集"                | admin, manager          |
| 削除ボタン        | Button       | "削除"                | admin                   |

---

## 4. 画面遷移

### 4.1 遷移元画面
- 社員一覧画面（SRC0002）
- 社員編集画面（SRC0004）

### 4.2 遷移先画面
| 操作対象          | 遷移先画面          | 遷移条件              |
|-------------------|--------------------|-----------------------|
| 編集ボタン        | 社員編集画面 (SRC0004) | クリック + 権限確認 |
| 戻るボタン        | 社員一覧画面 (SRC0002) | クリック             |
| パンくずリスト    | 各階層画面          | クリック              |
| スキルタグ        | 社員一覧画面（フィルタ済み） | クリック   |

### 4.3 パラメータ受け渡し
```typescript
// URL構造
/employees/detail/[employee_id]

// 編集画面への遷移
router.push(`/employees/edit/${employee.employee_id}`);

// スキルフィルタ付き一覧画面への遷移
router.push(`/employees?skill=${encodeURIComponent(skillName)}`);
```

---

## 5. API連携

### 5.1 使用API
| API ID      | 呼び出しタイミング    | 用途                    |
|-------------|----------------------|-------------------------|
| API_EMP_002 | 画面表示時            | 社員詳細データ取得      |
| API_AUTH_002| 画面表示時            | ユーザー権限確認        |

### 5.2 API呼び出し仕様
#### API_EMP_002: 社員詳細取得
```typescript
const fetchEmployeeDetail = async (employeeId: string) => {
  setIsLoading(true);
  try {
    const response = await fetch(`/api/employee/detail/${employeeId}`, {
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}`);
    }
    
    const data = await response.json();
    if (data.success) {
      setEmployee(data);
    } else {
      setError(data.message || '社員情報の取得に失敗しました');
    }
  } catch (err) {
    setError(err.message);
  } finally {
    setIsLoading(false);
  }
};
```

---

## 6. データ構造

### 6.1 State管理
```typescript
interface EmployeeDetailState {
  employee: EmployeeDetail | null;
  isLoading: boolean;
  error: string | null;
  userRole: string;
  canEdit: boolean;
  canDelete: boolean;
}

interface EmployeeDetail {
  employee_id: string;
  full_name: string;
  email: string;
  phone?: string;
  department: string;
  position: string;
  status: 'active' | 'inactive' | 'on_leave';
  skill: string[];
  join_date: string;
  created_at: string;
  updated_at: string;
}
```

### 6.2 権限制御
```typescript
const calculatePermissions = (userRole: string, employeeData: EmployeeDetail) => {
  const canEdit = ['admin', 'manager'].includes(userRole);
  const canDelete = userRole === 'admin';
  
  return { canEdit, canDelete };
};
```

---

## 7. 削除機能

### 7.1 削除確認ダイアログ
```typescript
const DeleteConfirmDialog = ({ open, onClose, onConfirm, employeeName }) => (
  <Dialog open={open} onClose={onClose}>
    <DialogTitle>社員情報の削除</DialogTitle>
    <DialogContent>
      <Typography>
        「{employeeName}」の社員情報を削除してもよろしいですか？
      </Typography>
      <Alert severity="warning" sx={{ mt: 2 }}>
        この操作は取り消すことができません。
      </Alert>
    </DialogContent>
    <DialogActions>
      <Button onClick={onClose}>キャンセル</Button>
      <Button onClick={onConfirm} variant="contained" color="error">
        削除
      </Button>
    </DialogActions>
  </Dialog>
);
```

### 7.2 削除処理フロー
1. 削除ボタンクリック
2. 確認ダイアログ表示
3. 削除実行確認
4. API呼び出し（DELETE /api/employee/[id]）
5. 成功時: 一覧画面へリダイレクト
6. 失敗時: エラーメッセージ表示

---

## 8. スキル表示機能

### 8.1 スキルタグ仕様
```typescript
const SkillChip = ({ skill, onClick }) => (
  <Chip
    label={skill}
    variant="outlined"
    clickable
    onClick={() => onClick(skill)}
    sx={{
      m: 0.5,
      '&:hover': {
        backgroundColor: 'primary.light',
        color: 'white'
      }
    }}
  />
);
```

### 8.2 スキル分類
| カテゴリ          | 色分け                | 例                      |
|-------------------|-----------------------|-------------------------|
| プログラミング言語| primary               | JavaScript, Python      |
| フレームワーク    | secondary             | React, Node.js          |
| データベース      | success               | MongoDB, MySQL          |
| クラウド          | info                  | AWS, Azure              |
| その他            | default               | 営業, 企画              |

---

## 9. エラーハンドリング

### 9.1 エラーパターン
| エラー種別        | 表示内容                    | 対処法                    |
|-------------------|----------------------------|---------------------------|
| 社員不存在        | "指定された社員が見つかりません" | 一覧画面へリダイレクト |
| アクセス権限なし  | "アクセス権限がありません"  | 403エラーページ表示       |
| ネットワークエラー| "データの読み込みに失敗"    | 再読み込みボタン表示      |
| サーバーエラー    | "システムエラーが発生"      | エラーページ表示          |

### 9.2 404エラー対応
```typescript
// 社員不存在時の表示
const NotFoundError = () => (
  <Box textAlign="center" py={8}>
    <PersonOffIcon sx={{ fontSize: 64, color: 'grey.400' }} />
    <Typography variant="h5" gutterBottom>
      社員が見つかりません
    </Typography>
    <Typography variant="body1" color="textSecondary" gutterBottom>
      指定された社員ID「{employeeId}」は存在しません。
    </Typography>
    <Button 
      variant="contained" 
      onClick={() => router.push('/employees')}
      sx={{ mt: 2 }}
    >
      社員一覧に戻る
    </Button>
  </Box>
);
```

---

## 10. 読み込み状態

### 10.1 スケルトン表示
```typescript
const EmployeeDetailSkeleton = () => (
  <Box>
    <Skeleton variant="text" width="60%" height={40} />
    <Skeleton variant="text" width="40%" height={30} />
    <Box mt={2}>
      <Skeleton variant="rectangular" width="100%" height={200} />
    </Box>
    <Box mt={2} display="flex" gap={1}>
      <Skeleton variant="rounded" width={80} height={32} />
      <Skeleton variant="rounded" width={80} height={32} />
      <Skeleton variant="rounded" width={80} height={32} />
    </Box>
  </Box>
);
```

### 10.2 プログレシブ表示
1. 基本情報表示
2. スキル情報表示
3. アクションボタン表示

---

## 11. パフォーマンス最適化

### 11.1 データキャッシュ
```typescript
// React Query使用例
const { data: employee, isLoading, error } = useQuery({
  queryKey: ['employee', employeeId],
  queryFn: () => fetchEmployeeDetail(employeeId),
  staleTime: 5 * 60 * 1000, // 5分間キャッシュ
  cacheTime: 10 * 60 * 1000, // 10分間保持
});
```

### 11.2 画像遅延読み込み
```typescript
// 社員画像がある場合の遅延読み込み
const LazyEmployeeImage = ({ src, alt }) => (
  <Box sx={{ width: 120, height: 120 }}>
    <Image
      src={src}
      alt={alt}
      loading="lazy"
      style={{ borderRadius: '50%' }}
    />
  </Box>
);
```

---

## 12. アクセシビリティ

### 12.1 ARIA属性
```typescript
<Box role="main" aria-labelledby="employee-name">
  <Typography id="employee-name" variant="h4">
    {employee.full_name}
  </Typography>
  
  <Box role="region" aria-labelledby="basic-info-title">
    <Typography id="basic-info-title" variant="h6">
      基本情報
    </Typography>
    {/* 基本情報コンテンツ */}
  </Box>
</Box>
```

### 12.2 キーボードナビゲーション
| キー              | 動作                      |
|-------------------|---------------------------|
| Tab               | フォーカス移動            |
| Enter             | ボタン実行                |
| Escape            | ダイアログ閉じる          |
| Ctrl + E          | 編集画面遷移              |

---

## 13. 国際化対応

### 13.1 日付フォーマット
```typescript
const formatDate = (dateString: string, locale = 'ja-JP') => {
  const date = new Date(dateString);
  return date.toLocaleDateString(locale, {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
};
```

### 13.2 多言語文字列
```typescript
const strings = {
  ja: {
    title: "社員詳細",
    edit: "編集",
    delete: "削除",
    back: "戻る",
    basicInfo: "基本情報",
    skills: "スキル・専門性"
  },
  en: {
    title: "Employee Detail",
    edit: "Edit",
    delete: "Delete",
    back: "Back",
    basicInfo: "Basic Information",
    skills: "Skills & Expertise"
  }
};
```

---

## 14. テスト仕様

### 14.1 単体テスト
```typescript
describe('EmployeeDetail Component', () => {
  test('社員情報が正しく表示される', () => {
    render(<EmployeeDetail employeeId="EMP001" />);
    expect(screen.getByText('田中太郎')).toBeInTheDocument();
    expect(screen.getByText('EMP001')).toBeInTheDocument();
  });
  
  test('権限に応じてボタンが表示される', () => {
    render(<EmployeeDetail employeeId="EMP001" userRole="admin" />);
    expect(screen.getByText('編集')).toBeInTheDocument();
    expect(screen.getByText('削除')).toBeInTheDocument();
  });
});
```

### 14.2 統合テスト
- API連携テスト
- 権限制御テスト
- エラーハンドリングテスト

### 14.3 E2Eテスト
```typescript
test('社員詳細表示から編集画面への遷移', async ({ page }) => {
  await page.goto('/employees/detail/EMP001');
  await page.click('[data-testid="edit-button"]');
  await expect(page).toHaveURL('/employees/edit/EMP001');
});
```

---

## チェックリスト
- [x] 詳細情報表示仕様定義
- [x] 権限制御機能実装
- [x] 削除機能・確認ダイアログ実装
- [x] エラーハンドリング完備
- [x] アクセシビリティ対応
- [x] レスポンシブデザイン対応
- [x] パフォーマンス最適化考慮
- [x] 国際化対応
- [x] テスト仕様策定