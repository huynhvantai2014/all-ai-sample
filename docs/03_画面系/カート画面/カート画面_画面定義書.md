# 画面定義書 - カート画面

---

**画面名**：カート画面
**画面ID**：SRC0007
**画面物理名**：cart
**URL**：/cart

## 画面で使用するAPI一覧

### API 1: カート内容取得API

---
**API ID**: CART001
**API名**: カート内容取得
**エンドポイント**: /api/cart
**メソッド**: GET

#### 1. 機能概要 (Tóm tắt chức năng)
- 現在のユーザーのカート内容を取得し、商品リスト・合計金額を表示する

#### 2. パラメータ定義 (Định nghĩa tham số)
| パラメータ名 | 種別 | 必須 | 型 | 桁数 | 説明 |
|--------------|------|------|----|------|------|
| userId       | header | ○  | string | 20 | ユーザーID |

#### 3. レスポンス定義 (Định nghĩa response)
| フィールド名 | 型 | 桁数 | 説明 |
|--------------|----|------|------|
| items        | array | - | カート商品リスト |
| items[].id   | string | 20 | カートアイテムID |
| items[].productId | string | 20 | 商品ID |
| items[].productName | string | 255 | 商品名 |
| items[].imageUrl | string | 500 | 商品画像URL |
| items[].quantity | number | 10 | 数量 |
| items[].unitPrice | number | 10,2 | 単価 |
| items[].subtotal | number | 10,2 | 小計 |
| summary      | object | - | カート合計 |
| summary.itemCount | number | 10 | 商品点数 |
| summary.subtotal | number | 10,2 | 小計 |
| summary.tax  | number | 10,2 | 消費税 |
| summary.total | number | 10,2 | 合計金額 |
| isEmpty      | boolean | - | 空カートフラグ |

#### 4. エラーコード・メッセージ (Mã lỗi, message)
| コード | メッセージ | 条件 |
|--------|------------|------|
| 401    | 認証が必要です | ユーザー未認証 |
| 500    | システムエラーが発生しました | サーバーエラー |

#### 5. 処理フロー (Luồng xử lý API)
- 1. 入力バリデーション (Validate đầu vào):
    - userIdの必須チェック
- 2. 相関バリデーション (Validate tương関/DB):
    - usersテーブルでuserID存在チェック
- 3. 業務処理 (Xử lý nghiệp vụ):
    - cart_itemsテーブルからユーザーのカート取得
    - productsテーブルと結合して商品詳細取得
    - 合計金額・税額計算
- 4. レスポンス生成 (Trả kết quả):
    - カート内容・合計情報返却

#### 6. 備考 (Ghi chú)
- 空カート時は専用メッセージ表示

### API 2: カート商品更新API

---
**API ID**: CART002
**API名**: カート商品更新
**エンドポイント**: /api/cart/items/{itemId}
**メソッド**: PUT

#### 1. 機能概要 (Tóm tắt chức năng)
- カート内商品の数量を更新し、合計金額を再計算する

#### 2. パラメータ定義 (Định nghĩa tham số)
| パラメータ名 | 種別 | 必須 | 型 | 桁数 | 説明 |
|--------------|------|------|----|------|------|
| itemId       | path | ○   | string | 20 | カートアイテムID |
| quantity     | body | ○   | number | 10 | 新しい数量 |

#### 3. レスポンス定義 (Định nghĩa response)
| フィールド名 | 型 | 桁数 | 説明 |
|--------------|----|------|------|
| success      | boolean | - | 更新成功/失敗 |
| item         | object | - | 更新された商品 |
| cartSummary  | object | - | カート合計 |

#### 4. エラーコード・メッセージ (Mã lỗi, message)
| コード | メッセージ | 条件 |
|--------|------------|------|
| 400    | 数量は1以上で入力してください | 数量不正 |
| 404    | 商品が見つかりません | itemId不正 |
| 500    | システムエラーが発生しました | サーバーエラー |

#### 5. 処理フロー (Luồng xử lý API)
- 1. 入力バリデーション (Validate đầu vào):
    - quantityの正数チェック
- 2. 相関バリデーション (Validate tương関/DB):
    - cart_itemsテーブルでitemId存在チェック
- 3. 業務処理 (Xử lý nghiệp vụ):
    - 数量更新・小計再計算
    - カート合計金額再計算
- 4. レスポンス生成 (Trả kết quả):
    - 更新結果・カート合計返却

#### 6. 備考 (Ghi chú)
- 数量0で商品削除

### API 3: カート商品削除API

---
**API ID**: CART003
**API名**: カート商品削除
**エンドポイント**: /api/cart/items/{itemId}
**メソッド**: DELETE

#### 1. 機能概要 (Tóm tắt chức năng)
- カートから指定商品を削除し、合計金額を再計算する

#### 2. パラメータ定義 (Định nghĩa tham số)
| パラメータ名 | 種別 | 必須 | 型 | 桁数 | 説明 |
|--------------|------|------|----|------|------|
| itemId       | path | ○   | string | 20 | カートアイテムID |

#### 3. レスポンス定義 (Định nghĩa response)
| フィールド名 | 型 | 桁数 | 説明 |
|--------------|----|------|------|
| success      | boolean | - | 削除成功/失敗 |
| cartSummary  | object | - | カート合計 |

#### 4. エラーコード・メッセージ (Mã lỗi, message)
| コード | メッセージ | 条件 |
|--------|------------|------|
| 404    | 商品が見つかりません | itemId不正 |
| 500    | システムエラーが発生しました | サーバーエラー |

#### 5. 処理フロー (Luồng xử lý API)
- 1. 入力バリデーション (Validate đầu vào):
    - itemIdの必須チェック
- 2. 相関バリデーション (Validate tương関/DB):
    - cart_itemsテーブルでitemId存在チェック
- 3. 業務処理 (Xử lý nghiệp vụ):
    - cart_itemsテーブルから削除
    - カート合計金額再計算
- 4. レスポンス生成 (Trả kết quả):
    - 削除結果・カート合計返却

#### 6. 備考 (Ghi chú)
- 削除後空カートの場合は特別表示

---

## 関連テーブル

- **cart_items**: カート商品
- **products**: 商品マスタ
- **users**: ユーザー情報