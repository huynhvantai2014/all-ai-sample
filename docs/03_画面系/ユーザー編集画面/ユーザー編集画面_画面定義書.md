# 画面定義書 - ユーザー編集画面

---

**画面名**：ユーザー編集画面
**画面ID**：SRC0011
**画面物理名**：user_edit
**URL**：/user/edit

## 画面で使用するAPI一覧

### API 1: ユーザー情報更新API

---
**API ID**: USR004
**API名**: ユーザー情報更新
**エンドポイント**: /api/users/{userId}
**メソッド**: PUT

#### 1. 機能概要 (Tóm tắt chức năng)
- ユーザーの基本情報・権限・所属店舗等を更新する

#### 2. パラメータ定義 (Định nghĩa tham số)
| パラメータ名 | 種別 | 必須 | 型 | 桁数 | 説明 |
|--------------|------|------|----|------|------|
| userId       | path | ○   | string | 20 | ユーザーID |
| fullName     | body | ○   | string | 100 | 氏名 |
| email        | body | ○   | string | 255 | メールアドレス |
| phone        | body |     | string | 20 | 電話番号 |
| roleId       | body | ○   | string | 20 | ロールID |
| storeId      | body | ○   | string | 20 | 所属店舗ID |
| permissions  | body |     | array | - | 個別権限リスト |

#### 3. レスポンス定義 (Định nghĩa response)
| フィールド名 | 型 | 桁数 | 説明 |
|--------------|----|------|------|
| success      | boolean | - | 更新成功/失敗 |
| message      | string | 255 | メッセージ |

#### 4. エラーコード・メッセージ (Mã lỗi, message)
| コード | メッセージ | 条件 |
|--------|------------|------|
| 400    | 必須項目が入力されていません | 必須項目不足 |
| 400    | メールアドレスの形式が正しくありません | email形式不正 |
| 403    | アクセス権限がありません | 権限不足 |
| 404    | ユーザーが見つかりません | userId不正 |
| 409    | メールアドレスが既に使用されています | email重複 |
| 500    | システムエラーが発生しました | サーバーエラー |

#### 5. 処理フロー (Luồng xử lý API)
- 1. 入力バリデーション (Validate đầu vào):
    - 必須項目・email形式チェック
- 2. 相関バリデーション (Validate tương关/DB):
    - 管理者権限チェック
    - ユーザー存在チェック
    - email重複チェック
    - ロール・店舗存在チェック
- 3. 業務処理 (Xử lý nghiệp vụ):
    - usersテーブル更新
    - user_permissionsテーブル更新
    - 更新履歴記録
- 4. レスポンス生成 (Trả kết quả):
    - 更新結果返却

#### 6. 備考 (Ghi chú)
- パスワード変更は別API

### API 2: ユーザー新規作成API

---
**API ID**: USR005
**API名**: ユーザー新規作成
**エンドポイント**: /api/users
**メソッド**: POST

#### 1. 機能概要 (Tóm tắt chức năng)
- 新規ユーザーを作成し、初期パスワードを設定する

#### 2. パラメータ定義 (Định nghĩa tham số)
| パラメータ名 | 種別 | 必須 | 型 | 桁数 | 説明 |
|--------------|------|------|----|------|------|
| username     | body | ○   | string | 50 | ユーザー名 |
| fullName     | body | ○   | string | 100 | 氏名 |
| email        | body | ○   | string | 255 | メールアドレス |
| phone        | body |     | string | 20 | 電話番号 |
| roleId       | body | ○   | string | 20 | ロールID |
| storeId      | body | ○   | string | 20 | 所属店舗ID |
| temporaryPassword | body | ○ | string | 100 | 初期パスワード |

#### 3. レスポンス定義 (Định nghĩa response)
| フィールド名 | 型 | 桁数 | 説明 |
|--------------|----|------|------|
| success      | boolean | - | 作成成功/失敗 |
| userId       | string | 20 | 作成されたユーザーID |
| message      | string | 255 | メッセージ |

#### 4. エラーコード・メッセージ (Mã lỗi, message)
| コード | メッセージ | 条件 |
|--------|------------|------|
| 400    | 必須項目が入力されていません | 必須項目不足 |
| 403    | アクセス権限がありません | 権限不足 |
| 409    | ユーザー名が既に使用されています | username重複 |
| 409    | メールアドレスが既に使用されています | email重複 |
| 500    | システムエラーが発生しました | サーバーエラー |

#### 5. 処理フロー (Luồng xử lý API)
- 1. 入力バリデーション (Validate đầu vào):
    - 必須項目・形式チェック
    - パスワード強度チェック
- 2. 相関バリデーション (Validate tương关/DB):
    - 管理者権限チェック
    - username・email重複チェック
    - ロール・店舗存在チェック
- 3. 業務処理 (Xử lý nghiệp vụ):
    - ユーザーID生成
    - パスワードハッシュ化
    - usersテーブルに登録
    - 初期権限設定
- 4. レスポンス生成 (Trả kết quả):
    - 作成結果・ユーザーID返却

#### 6. 備考 (Ghi chú)
- 初回ログイン時パスワード変更必須

### API 3: パスワード変更API

---
**API ID**: USR006
**API名**: パスワード変更
**エンドポイント**: /api/users/{userId}/password
**メソッド**: PUT

#### 1. 機能概要 (Tóm tắt chức năng)
- ユーザーのパスワードを変更する

#### 2. パラメータ定義 (Định nghĩa tham số)
| パラメータ名 | 種別 | 必須 | 型 | 桁数 | 説明 |
|--------------|------|------|----|------|------|
| userId       | path | ○   | string | 20 | ユーザーID |
| currentPassword | body | ○  | string | 100 | 現在のパスワード |
| newPassword  | body | ○   | string | 100 | 新しいパスワード |
| confirmPassword | body | ○ | string | 100 | 新しいパスワード（確認） |

#### 3. レスポンス定義 (Định nghĩa response)
| フィールド名 | 型 | 桁数 | 説明 |
|--------------|----|------|------|
| success      | boolean | - | 変更成功/失敗 |
| message      | string | 255 | メッセージ |

#### 4. エラーコード・メッセージ (Mã lỗi, message)
| コード | メッセージ | 条件 |
|--------|------------|------|
| 400    | パスワードが一致しません | 確認パスワード不一致 |
| 400    | パスワードの強度が不足しています | パスワード強度不足 |
| 401    | 現在のパスワードが正しくありません | 現在パスワード不正 |
| 404    | ユーザーが見つかりません | userId不正 |
| 500    | システムエラーが発生しました | サーバーエラー |

#### 5. 処理フロー (Luồng xử lý API)
- 1. 入力バリデーション (Validate đầu vào):
    - 必須項目チェック
    - newPassword = confirmPasswordチェック
    - パスワード強度チェック
- 2. 相関バリデーション (Validate tương关/DB):
    - ユーザー存在チェック
    - 現在パスワード照合
- 3. 業務処理 (Xử lý nghiệp vụ):
    - 新パスワードハッシュ化
    - usersテーブル更新
    - パスワード履歴記録
- 4. レスポンス生成 (Trả kết quả):
    - 変更結果返却

#### 6. 備考 (Ghi chú)
- パスワード履歴管理（過去5回分）

---

## 関連テーブル

- **users**: ユーザー情報
- **roles**: ロール定義
- **stores**: 店舗情報
- **user_permissions**: ユーザー権限
- **password_history**: パスワード履歴