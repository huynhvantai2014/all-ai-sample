# 画面定義書 - 売上レポート画面

---

**画面名**：売上レポート画面
**画面ID**：SRC0006
**画面物理名**：sales_report
**URL**：/sales_report

## 画面で使用するAPI一覧

### API 1: 売上データ取得API

---
**API ID**: RPT001
**API名**: 売上データ取得
**エンドポイント**: /api/reports/sales
**メソッド**: GET

#### 1. 機能概要 (Tóm tắt chức năng)
- 指定期間・条件での売上データを取得し、レポート表示用に整形する

#### 2. パラメータ定義 (Định nghĩa tham số)
| パラメータ名 | 種別 | 必須 | 型 | 桁数 | 説明 |
|--------------|------|------|----|------|------|
| dateFrom     | query | ○   | date | 10 | 集計開始日（YYYY-MM-DD） |
| dateTo       | query | ○   | date | 10 | 集計終了日（YYYY-MM-DD） |
| storeId      | query |     | string | 20 | 店舗ID |
| cashierId    | query |     | string | 20 | 担当者ID |
| groupBy      | query |     | string | 20 | グループ単位（daily/hourly/product/cashier） |

#### 3. レスポンス定義 (Định nghĩa response)
| フィールド名 | 型 | 桁数 | 説明 |
|--------------|----|------|------|
| summary      | object | - | 売上サマリー |
| summary.totalSales | number | 12,2 | 総売上金額 |
| summary.totalTransactions | number | 10 | 総取引数 |
| summary.averageTransaction | number | 10,2 | 平均客単価 |
| summary.taxAmount | number | 12,2 | 消費税合計 |
| details      | array | - | 詳細データ |
| details[].date | date | 10 | 日付 |
| details[].sales | number | 12,2 | 売上金額 |
| details[].transactions | number | 10 | 取引数 |

#### 4. エラーコード・メッセージ (Mã lỗi, message)
| コード | メッセージ | 条件 |
|--------|------------|------|
| 400    | 日付の形式が正しくありません | 日付形式エラー |
| 500    | システムエラーが発生しました | サーバーエラー |

#### 5. 処理フロー (Luồng xử lý API)
- 1. 入力バリデーション (Validate đầu vào):
    - 日付形式・範囲チェック
    - groupByの値チェック
- 2. 相関バリデーション (Validate tương关/DB):
    - 店舗・担当者存在チェック
- 3. 業務処理 (Xử lý nghiệp vụ):
    - transactionsテーブルから売上データ集計
    - 指定条件でグループ化・集計
    - サマリー計算
- 4. レスポンス生成 (Trả kết quả):
    - 売上レポートデータ返却

#### 6. 備考 (Ghi chú)
- CSV/Excel出力対応

### API 2: レポートエクスポートAPI

---
**API ID**: RPT002
**API名**: レポートエクスポート
**エンドポイント**: /api/reports/sales/export
**メソッド**: POST

#### 1. 機能概要 (Tóm tắt chức năng)
- 売上レポートをCSV/Excel形式でエクスポートする

#### 2. パラメータ定義 (Định nghĩa tham số)
| パラメータ名 | 種別 | 必須 | 型 | 桁数 | 説明 |
|--------------|------|------|----|------|------|
| dateFrom     | body | ○   | date | 10 | 集計開始日 |
| dateTo       | body | ○   | date | 10 | 集計終了日 |
| format       | body | ○   | string | 10 | 出力形式（csv/excel） |
| includeDetails | body |   | boolean | - | 詳細データ含む |

#### 3. レスポンス定義 (Định nghĩa response)
| フィールド名 | 型 | 桁数 | 説明 |
|--------------|----|------|------|
| success      | boolean | - | エクスポート成功/失敗 |
| downloadUrl  | string | 500 | ダウンロードURL |
| fileSize     | number | 10 | ファイルサイズ（バイト） |
| expiresAt    | datetime | - | URL有効期限 |

#### 4. エラーコード・メッセージ (Mã lỗi, message)
| コード | メッセージ | 条件 |
|--------|------------|------|
| 400    | 無効な出力形式です | format値不正 |
| 500    | エクスポートに失敗しました | ファイル生成エラー |

#### 5. 処理フロー (Luồng xử lý API)
- 1. 入力バリデーション (Validate đầu vào):
    - 必須項目・形式チェック
- 2. 相関バリデーション (Validate tương关/DB):
    - データ存在チェック
- 3. 業務処理 (Xử lý nghiệp vụ):
    - 売上データ取得・整形
    - CSV/Excelファイル生成
    - 一時保存・URL生成
- 4. レスポンス生成 (Trả kết quả):
    - ダウンロードURL返却

#### 6. 備考 (Ghi chú)
- ファイル一時保存（24時間）

---

## 関連テーブル

- **transactions**: 取引記録
- **transaction_items**: 取引明細
- **stores**: 店舗情報
- **users**: ユーザー情報
- **products**: 商品情報