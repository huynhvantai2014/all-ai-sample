# 画面定義書 - 商品管理画面

---

**画面名**：商品管理画面
**画面ID**：SRC0008
**画面物理名**：product_management
**URL**：/product_management

## 画面で使用するAPI一覧

### API 1: 商品一覧取得API

---
**API ID**: PROD003
**API名**: 商品一覧取得
**エンドポイント**: /api/products
**メソッド**: GET

#### 1. 機能概要 (Tóm tắt chức năng)
- 商品マスタの一覧を取得し、検索・ソート・ページング機能を提供する

#### 2. パラメータ定義 (Định nghĩa tham số)
| パラメータ名 | 種別 | 必須 | 型 | 桁数 | 説明 |
|--------------|------|------|----|------|------|
| keyword      | query |     | string | 100 | 検索キーワード |
| category     | query |     | string | 20 | カテゴリID |
| sortBy       | query |     | string | 20 | ソート項目 |
| sortOrder    | query |     | string | 10 | ソート順（asc/desc） |
| limit        | query |     | number | 3  | 取得件数 |
| offset       | query |     | number | 10 | 取得開始位置 |

#### 3. レスポンス定義 (Định nghĩa response)
| フィールド名 | 型 | 桁数 | 説明 |
|--------------|----|------|------|
| products     | array | - | 商品リスト |
| products[].id | string | 20 | 商品ID |
| products[].name | string | 255 | 商品名 |
| products[].sku | string | 50 | SKU |
| products[].janCode | string | 20 | JANコード |
| products[].price | number | 10,2 | 価格 |
| products[].stock | number | 10 | 在庫数 |
| products[].category | string | 100 | カテゴリ名 |
| products[].imageUrl | string | 500 | 商品画像URL |
| products[].status | string | 20 | 状態（active/inactive） |
| total        | number | 10 | 総件数 |

#### 4. エラーコード・メッセージ (Mã lỗi, message)
| コード | メッセージ | 条件 |
|--------|------------|------|
| 400    | 検索条件が正しくありません | パラメータ不正 |
| 500    | システムエラーが発生しました | サーバーエラー |

#### 5. 処理フロー (Luồng xử lý API)
- 1. 入力バリデーション (Validate đầu vào):
    - パラメータ形式チェック
- 2. 相関バリデーション (Validate tương関/DB):
    - カテゴリ存在チェック
- 3. 業務処理 (Xử lý nghiệp vụ):
    - productsテーブルから条件検索
    - stocksテーブルと結合して在庫取得
    - ソート・ページング処理
- 4. レスポンス生成 (Trả kết quả):
    - 商品一覧・総件数返却

#### 6. 備考 (Ghi chú)
- 在庫警告表示機能

### API 2: 商品詳細取得API

---
**API ID**: PROD004
**API名**: 商品詳細取得
**エンドポイント**: /api/products/{productId}
**メソッド**: GET

#### 1. 機能概要 (Tóm tắt chức năng)
- 指定商品の詳細情報を取得する

#### 2. パラメータ定義 (Định nghĩa tham số)
| パラメータ名 | 種別 | 必須 | 型 | 桁数 | 説明 |
|--------------|------|------|----|------|------|
| productId    | path | ○   | string | 20 | 商品ID |

#### 3. レスポンス定義 (Định nghĩa response)
| フィールド名 | 型 | 桁数 | 説明 |
|--------------|----|------|------|
| product      | object | - | 商品詳細 |
| product.id   | string | 20 | 商品ID |
| product.name | string | 255 | 商品名 |
| product.description | string | 1000 | 商品説明 |
| product.sku  | string | 50 | SKU |
| product.janCode | string | 20 | JANコード |
| product.price | number | 10,2 | 価格 |
| product.costPrice | number | 10,2 | 原価 |
| product.stock | number | 10 | 在庫数 |
| product.categoryId | string | 20 | カテゴリID |
| product.supplierId | string | 20 | 仕入先ID |
| product.taxRate | number | 5,3 | 税率 |
| product.images | array | - | 商品画像リスト |

#### 4. エラーコード・メッセージ (Mã lỗi, message)
| コード | メッセージ | 条件 |
|--------|------------|------|
| 404    | 商品が見つかりません | productId不正 |
| 500    | システムエラーが発生しました | サーバーエラー |

#### 5. 処理フロー (Luồng xử lý API)
- 1. 入力バリデーション (Validate đầu vào):
    - productIdの必須チェック
- 2. 相関バリデーション (Validate tương关/DB):
    - productsテーブルでproductId存在チェック
- 3. 業務処理 (Xử lý nghiệp vụ):
    - 商品詳細情報取得
    - 関連テーブル結合（カテゴリ、仕入先等）
- 4. レスポンス生成 (Trả kết quả):
    - 商品詳細情報返却

#### 6. 備考 (Ghi chú)
- 複数画像対応

### API 3: 商品登録・更新API

---
**API ID**: PROD005
**API名**: 商品登録・更新
**エンドポイント**: /api/products
**メソッド**: POST/PUT

#### 1. 機能概要 (Tóm tắt chức năng)
- 新規商品登録または既存商品情報を更新する

#### 2. パラメータ定義 (Định nghĩa tham số)
| パラメータ名 | 種別 | 必須 | 型 | 桁数 | 説明 |
|--------------|------|------|----|------|------|
| name         | body | ○   | string | 255 | 商品名 |
| description  | body |     | string | 1000 | 商品説明 |
| sku          | body | ○   | string | 50 | SKU |
| janCode      | body |     | string | 20 | JANコード |
| price        | body | ○   | number | 10,2 | 価格 |
| costPrice    | body |     | number | 10,2 | 原価 |
| categoryId   | body | ○   | string | 20 | カテゴリID |
| supplierId   | body |     | string | 20 | 仕入先ID |
| taxRate      | body |     | number | 5,3 | 税率 |

#### 3. レスポンス定義 (Định nghĩa response)
| フィールド名 | 型 | 桁数 | 説明 |
|--------------|----|------|------|
| success      | boolean | - | 登録・更新成功/失敗 |
| productId    | string | 20 | 商品ID |
| message      | string | 255 | メッセージ |

#### 4. エラーコード・メッセージ (Mã lỗi, message)
| コード | メッセージ | 条件 |
|--------|------------|------|
| 400    | 必須項目が入力されていません | 必須項目不足 |
| 409    | SKUが既に使用されています | SKU重複 |
| 500    | システムエラーが発生しました | サーバーエラー |

#### 5. 処理フロー (Luồng xử lý API)
- 1. 入力バリデーション (Validate đầu vào):
    - 必須項目・形式チェック
- 2. 相関バリデーション (Validate tương関/DB):
    - SKU重複チェック
    - カテゴリ・仕入先存在チェック
- 3. 業務処理 (Xử lý nghiệp vụ):
    - productsテーブルに登録・更新
    - 商品画像処理
    - 初期在庫設定
- 4. レスポンス生成 (Trả kết quả):
    - 登録・更新結果返却

#### 6. 備考 (Ghi chú)
- SKU自動生成オプション

### API 4: 在庫調整API

---
**API ID**: STK001
**API名**: 在庫調整
**エンドポイント**: /api/products/{productId}/stock
**メソッド**: PUT

#### 1. 機能概要 (Tóm tắt chức năng)
- 商品の在庫数を調整し、調整履歴を記録する

#### 2. パラメータ定義 (Định nghĩa tham số)
| パラメータ名 | 種別 | 必須 | 型 | 桁数 | 説明 |
|--------------|------|------|----|------|------|
| productId    | path | ○   | string | 20 | 商品ID |
| adjustment   | body | ○   | number | 10 | 調整数量（+/-） |
| reason       | body | ○   | string | 255 | 調整理由 |
| userId       | body | ○   | string | 20 | 調整者ID |

#### 3. レスポンス定義 (Định nghĩa response)
| フィールド名 | 型 | 桁数 | 説明 |
|--------------|----|------|------|
| success      | boolean | - | 調整成功/失敗 |
| newStock     | number | 10 | 調整後在庫数 |
| adjustmentId | string | 20 | 調整履歴ID |

#### 4. エラーコード・メッセージ (Mã lỗi, message)
| コード | メッセージ | 条件 |
|--------|------------|------|
| 400    | 在庫がマイナスになります | 在庫不足 |
| 404    | 商品が見つかりません | productId不正 |
| 500    | システムエラーが発生しました | サーバーエラー |

#### 5. 処理フロー (Luồng xử lý API)
- 1. 入力バリデーション (Validate đầu vào):
    - 必須項目チェック
- 2. 相関バリデーション (Validate tương关/DB):
    - 商品存在チェック
    - 在庫マイナスチェック
- 3. 業務処理 (Xử lý nghiệp vụ):
    - stocksテーブル更新
    - stock_adjustmentsテーブルに履歴記録
- 4. レスポンス生成 (Trả kết quả):
    - 調整結果返却

#### 6. 備考 (Ghi chú)
- 調整履歴は監査用途で保存

---

## 関連テーブル

- **products**: 商品マスタ
- **stocks**: 在庫情報
- **categories**: 商品カテゴリ
- **suppliers**: 仕入先マスタ
- **stock_adjustments**: 在庫調整履歴
- **product_images**: 商品画像