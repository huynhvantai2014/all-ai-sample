# API定義書（IPA標準）

API名: importEmployeeCSV
API ID: API_EMPLOYEE_IMPORT_001
エンドポイント: /api/employee/import/csv
HTTPメソッド: POST
関連画面: 新規社員追加画面

## 1. 機能概要
CSVファイルから社員情報を一括インポートする。ファイル形式・データ内容の検証を行い、エラーがある場合は詳細情報を返却する。

## 2. 入力パラメータ

| パラメータ名 | 必須 | データ型 | 桁数 | 説明 | 備考 |
|--------------|------|----------|------|------|------|
| file | ○ | file | - | CSVファイル | multipart/form-data |
| skip_header | △ | boolean | - | ヘッダー行スキップ | デフォルト：true |
| dry_run | △ | boolean | - | テスト実行 | デフォルト：false |

## 3. 出力パラメータ

| フィールド名 | データ型 | 桁数 | 説明 | 備考 |
|--------------|----------|------|------|------|
| success | boolean | - | 処理成功フラグ | true/false |
| import_count | number | - | インポート成功件数 | - |
| error_count | number | - | エラー件数 | - |
| total_count | number | - | 総件数 | - |
| errors | array | - | エラー詳細リスト | - |
| errors[].row | number | - | エラー行番号 | - |
| errors[].column | string | 50 | エラー列名 | - |
| errors[].message | string | 500 | エラーメッセージ | - |
| preview | array | - | インポート予定データ（dry_run時） | - |

## 4. エラーコード・メッセージ

| エラーコード | メッセージ | 発生条件 |
|--------------|------------|----------|
| E501 | ファイル不備 | ファイルが選択されていない |
| E502 | ファイル形式エラー | CSVファイル以外 |
| E503 | ファイルサイズ超過 | 10MB超過 |
| E504 | データ形式エラー | CSVデータ形式不正 |
| E505 | 権限不足 | インポート権限なし |
| E506 | 処理失敗 | DB登録エラー |
| E999 | システムエラー | 予期しないエラー |

## 5. 処理フロー
1. ファイル検証（形式・サイズ）
2. 権限チェック
3. CSVデータ解析
4. データ内容検証
5. 重複チェック
6. DB登録処理（dry_run以外）
7. 結果返却

## 6. セキュリティ・その他
- 管理者のみインポート可能
- ファイルサイズ制限：10MB
- 一度に最大1000件まで
- トランザクション制御

## 7. テストケース
- 正常ケース: 正しいCSVファイル
- 異常ケース: 不正なファイル、権限なし、サイズ超過

## 8. 備考
- AIによるデータ自動分類・エラー補助機能付き（最大30%創造性）
- dry_runモードでインポート前検証可能