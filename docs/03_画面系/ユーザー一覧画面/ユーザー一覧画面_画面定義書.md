# 画面定義書 - ユーザー一覧画面

---

**画面名**：ユーザー一覧画面
**画面ID**：SRC0010
**画面物理名**：user_list
**URL**：/user/list

## 画面で使用するAPI一覧

### API 1: ユーザー一覧取得API

---
**API ID**: USR001
**API名**: ユーザー一覧取得
**エンドポイント**: /api/users
**メソッド**: GET

#### 1. 機能概要 (Tóm tắt chức năng)
- システムユーザーの一覧を取得し、検索・フィルタ・ソート機能を提供する

#### 2. パラメータ定義 (Định nghĩa tham số)
| パラメータ名 | 種別 | 必須 | 型 | 桁数 | 説明 |
|--------------|------|------|----|------|------|
| keyword      | query |     | string | 100 | 検索キーワード（名前・ID） |
| role         | query |     | string | 20 | ロールフィルタ |
| status       | query |     | string | 20 | 状態フィルタ（active/inactive） |
| storeId      | query |     | string | 20 | 店舗ID |
| sortBy       | query |     | string | 20 | ソート項目 |
| sortOrder    | query |     | string | 10 | ソート順（asc/desc） |
| limit        | query |     | number | 3  | 取得件数 |
| offset       | query |     | number | 10 | 取得開始位置 |

#### 3. レスポンス定義 (Định nghĩa response)
| フィールド名 | 型 | 桁数 | 説明 |
|--------------|----|------|------|
| users        | array | - | ユーザーリスト |
| users[].id   | string | 20 | ユーザーID |
| users[].username | string | 50 | ユーザー名 |
| users[].fullName | string | 100 | 氏名 |
| users[].email | string | 255 | メールアドレス |
| users[].role | string | 50 | ロール |
| users[].storeName | string | 100 | 所属店舗名 |
| users[].status | string | 20 | 状態 |
| users[].lastLoginAt | datetime | - | 最終ログイン日時 |
| users[].createdAt | datetime | - | 作成日時 |
| total        | number | 10 | 総件数 |

#### 4. エラーコード・メッセージ (Mã lỗi, message)
| コード | メッセージ | 条件 |
|--------|------------|------|
| 400    | 検索条件が正しくありません | パラメータ不正 |
| 403    | アクセス権限がありません | 権限不足 |
| 500    | システムエラーが発生しました | サーバーエラー |

#### 5. 処理フロー (Luồng xử lý API)
- 1. 入力バリデーション (Validate đầu vào):
    - パラメータ形式チェック
- 2. 相関バリデーション (Validate tương关/DB):
    - 管理者権限チェック
    - 店舗存在チェック
- 3. 業務処理 (Xử lý nghiệp vụ):
    - usersテーブルから条件検索
    - stores, rolesテーブルと結合
    - ソート・ページング処理
- 4. レスポンス生成 (Trả kết quả):
    - ユーザー一覧・総件数返却

#### 6. 備考 (Ghi chú)
- 管理者専用機能

### API 2: ユーザー詳細取得API

---
**API ID**: USR002
**API名**: ユーザー詳細取得
**エンドポイント**: /api/users/{userId}
**メソッド**: GET

#### 1. 機能概要 (Tóm tắt chức năng)
- 指定ユーザーの詳細情報を取得する

#### 2. パラメータ定義 (Định nghĩa tham số)
| パラメータ名 | 種別 | 必須 | 型 | 桁数 | 説明 |
|--------------|------|------|----|------|------|
| userId       | path | ○   | string | 20 | ユーザーID |

#### 3. レスポンス定義 (Định nghĩa response)
| フィールド名 | 型 | 桁数 | 説明 |
|--------------|----|------|------|
| user         | object | - | ユーザー詳細 |
| user.id      | string | 20 | ユーザーID |
| user.username | string | 50 | ユーザー名 |
| user.fullName | string | 100 | 氏名 |
| user.email   | string | 255 | メールアドレス |
| user.phone   | string | 20 | 電話番号 |
| user.role    | string | 50 | ロール |
| user.storeId | string | 20 | 所属店舗ID |
| user.storeName | string | 100 | 所属店舗名 |
| user.status  | string | 20 | 状態 |
| user.permissions | array | - | 権限リスト |
| user.lastLoginAt | datetime | - | 最終ログイン日時 |
| user.createdAt | datetime | - | 作成日時 |

#### 4. エラーコード・メッセージ (Mã lỗi, message)
| コード | メッセージ | 条件 |
|--------|------------|------|
| 403    | アクセス権限がありません | 権限不足 |
| 404    | ユーザーが見つかりません | userId不正 |
| 500    | システムエラーが発生しました | サーバーエラー |

#### 5. 処理フロー (Luồng xử lý API)
- 1. 入力バリデーション (Validate đầu vào):
    - userIdの必須チェック
- 2. 相関バリデーション (Validate tương关/DB):
    - 管理者権限チェック
    - usersテーブルでuserId存在チェック
- 3. 業務処理 (Xử lý nghiệp vụ):
    - ユーザー詳細情報取得
    - 関連テーブル結合
    - 権限情報取得
- 4. レスポンス生成 (Trả kết quả):
    - ユーザー詳細情報返却

#### 6. 備考 (Ghi chú)
- パスワード情報は返却しない

### API 3: ユーザー状態変更API

---
**API ID**: USR003
**API名**: ユーザー状態変更
**エンドポイント**: /api/users/{userId}/status
**メソッド**: PUT

#### 1. 機能概要 (Tóm tắt chức năng)
- ユーザーの状態（アクティブ/非アクティブ）を変更する

#### 2. パラメータ定義 (Định nghĩa tham số)
| パラメータ名 | 種別 | 必須 | 型 | 桁数 | 説明 |
|--------------|------|------|----|------|------|
| userId       | path | ○   | string | 20 | ユーザーID |
| status       | body | ○   | string | 20 | 新しい状態（active/inactive） |
| reason       | body |     | string | 255 | 変更理由 |

#### 3. レスポンス定義 (Định nghĩa response)
| フィールド名 | 型 | 桁数 | 説明 |
|--------------|----|------|------|
| success      | boolean | - | 変更成功/失敗 |
| message      | string | 255 | メッセージ |

#### 4. エラーコード・メッセージ (Mã lỗi, message)
| コード | メッセージ | 条件 |
|--------|------------|------|
| 400    | 無効な状態です | status値不正 |
| 403    | アクセス権限がありません | 権限不足 |
| 404    | ユーザーが見つかりません | userId不正 |
| 500    | システムエラーが発生しました | サーバーエラー |

#### 5. 処理フロー (Luồng xử lý API)
- 1. 入力バリデーション (Validate đầu vào):
    - 必須項目・status値チェック
- 2. 相関バリデーション (Validate tương関/DB):
    - 管理者権限チェック
    - ユーザー存在チェック
- 3. 業務処理 (Xử lý nghiệp vụ):
    - usersテーブルのstatus更新
    - 変更履歴記録
- 4. レスポンス生成 (Trả kết quả):
    - 変更結果返却

#### 6. 備考 (Ghi chú)
- 自分自身の状態変更不可

---

## 関連テーブル

- **users**: ユーザー情報
- **roles**: ロール定義
- **stores**: 店舗情報
- **user_permissions**: ユーザー権限
- **user_status_history**: 状態変更履歴