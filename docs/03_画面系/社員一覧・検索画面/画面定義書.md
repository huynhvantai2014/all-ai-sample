# 画面定義書
## 社員一覧・検索画面 (Employee List & Search Screen)

### 画面ID: SRC0002
### 最終更新日: 2025年10月30日

---

## 1. 画面概要

### 1.1 画面名
**社員一覧・検索画面 (Employee List & Search)**

### 1.2 機能概要
社員情報の一覧表示、検索・フィルタリング機能を提供。社員詳細への遷移、新規登録への導線も含む。

### 1.3 画面種別
- **一覧表示画面**
- **検索・フィルタ機能付き**

### 1.4 アクセス権限
- **管理者 (admin)**: 全機能利用可能
- **マネージャー (manager)**: 閲覧・検索のみ
- **一般ユーザー (user)**: 制限付きアクセス

---

## 2. 画面レイアウト

### 2.1 画面構成
```
┌─────────────────────────────────────────────────┐
│ ヘッダー: タイトル + ログアウトボタン            │
├─────────────────────────────────────────────────┤
│ ナビゲーション                                  │
│ [社員一覧] [社員登録] [ダッシュボード]           │
├─────────────────────────────────────────────────┤
│ 検索・フィルタエリア                            │
│ ┌─────────────────────────────────────────┐     │
│ │ 検索: [________________] [検索]         │     │
│ │ 部門: [▼選択] ステータス: [▼選択]       │     │
│ │ [新規登録] [クリア]                     │     │
│ └─────────────────────────────────────────┘     │
├─────────────────────────────────────────────────┤
│ 社員一覧テーブル                                │
│ ┌─────────────────────────────────────────┐     │
│ │ ID   │氏名      │メール    │部門  │詳細│     │
│ │ EMP001│田中太郎  │tanaka@...│開発部│[>] │     │
│ │ EMP002│佐藤花子  │sato@...  │営業部│[>] │     │
│ │ EMP003│鈴木一郎  │suzuki@...│管理部│[>] │     │
│ └─────────────────────────────────────────┘     │
├─────────────────────────────────────────────────┤
│ ページネーション                                │
│ [<] 1 2 3 4 5 [>] (100件中 1-20件表示)          │
└─────────────────────────────────────────────────┘
```

### 2.2 レスポンシブデザイン
- **デスクトップ**: フルテーブル表示
- **タブレット**: 重要カラムのみ表示
- **モバイル**: カード形式表示

---

## 3. 画面要素定義

### 3.1 ヘッダー部
| 要素名            | 種別         | 表示内容              | 動作                    |
|-------------------|--------------|----------------------|-------------------------|
| タイトル          | Text         | "社員一覧"            | なし                    |
| ログアウトボタン  | Button       | "ログアウト"          | セッション終了、ログイン画面遷移 |

### 3.2 ナビゲーション部
| 要素名            | 種別         | 表示内容              | 動作                    |
|-------------------|--------------|----------------------|-------------------------|
| 社員一覧リンク    | Button/Link  | "社員一覧"            | 現在画面（アクティブ）  |
| 社員登録リンク    | Button/Link  | "社員登録"            | 社員登録画面遷移        |
| ダッシュボードリンク | Button/Link | "ダッシュボード"      | ホーム画面遷移          |

### 3.3 検索・フィルタエリア
| 要素名            | 種別         | プレースホルダー      | 動作                    |
|-------------------|--------------|----------------------|-------------------------|
| 検索入力欄        | TextField    | "氏名、メール等で検索" | リアルタイム検索        |
| 部門フィルタ      | Select       | "部門を選択"          | フィルタリング実行      |
| ステータスフィルタ| Select       | "ステータスを選択"    | フィルタリング実行      |
| 検索ボタン        | Button       | "検索"                | 検索実行                |
| クリアボタン      | Button       | "クリア"              | 検索条件リセット        |
| 新規登録ボタン    | Button       | "新規登録"            | 社員登録画面遷移        |

### 3.4 社員一覧テーブル
| カラム名          | 種別         | 表示内容              | ソート                  |
|-------------------|--------------|----------------------|-------------------------|
| 社員ID            | Text         | employee_id          | 昇順・降順              |
| 氏名              | Text         | full_name            | あいうえお順            |
| メールアドレス    | Text         | email（省略表示）    | なし                    |
| 部門              | Chip         | department           | 部門名順                |
| ステータス        | Chip         | status（色分け）     | なし                    |
| 詳細ボタン        | IconButton   | ">"                  | 詳細画面遷移            |

### 3.5 ページネーション
| 要素名            | 種別         | 表示内容              | 動作                    |
|-------------------|--------------|----------------------|-------------------------|
| 前ページボタン    | IconButton   | "<"                  | 前ページ移動            |
| ページ番号        | Button       | 数値                  | 指定ページ移動          |
| 次ページボタン    | IconButton   | ">"                  | 次ページ移動            |
| 件数表示          | Text         | "100件中 1-20件表示"  | なし                    |

---

## 4. 画面遷移

### 4.1 遷移元画面
- ホーム画面（SRC0001）
- 社員詳細画面（SRC0003）
- 社員編集画面（SRC0004）
- 社員登録画面（SRC0005）

### 4.2 遷移先画面
| 操作対象          | 遷移先画面          | 遷移条件              |
|-------------------|--------------------|-----------------------|
| 詳細ボタン        | 社員詳細画面 (SRC0003) | クリック + 社員ID   |
| 新規登録ボタン    | 社員登録画面 (SRC0005) | クリック             |
| ダッシュボードリンク | ホーム画面 (SRC0001) | クリック             |
| ログアウトボタン  | ログイン画面 (SRC0000) | クリック             |

### 4.3 パラメータ受け渡し
```typescript
// 社員詳細画面への遷移
router.push(`/employees/detail/${employee.employee_id}`);

// URLパラメータによる検索条件復元
const searchParams = useSearchParams();
const initialSearch = searchParams.get('search') || '';
```

---

## 5. API連携

### 5.1 使用API
| API ID      | 呼び出しタイミング    | 用途                    |
|-------------|----------------------|-------------------------|
| API_EMP_001 | 画面表示時・検索時    | 社員一覧データ取得      |
| API_AUTH_002| 画面表示時            | ユーザー情報・権限取得  |

### 5.2 API呼び出し仕様
#### API_EMP_001: 社員検索
```typescript
// リクエストパラメータ構築
const buildSearchParams = () => {
  const params = new URLSearchParams();
  if (searchTerm) params.append('search', searchTerm);
  if (selectedDepartment) params.append('department', selectedDepartment);
  if (selectedStatus) params.append('status', selectedStatus);
  params.append('page', String(currentPage));
  params.append('limit', String(itemsPerPage));
  return params;
};

// API呼び出し
const fetchEmployees = async () => {
  const params = buildSearchParams();
  const response = await fetch(`/api/employee/search?${params}`, {
    headers: {
      'Authorization': `Bearer ${token}`
    }
  });
  
  const data = await response.json();
  if (data.success) {
    setEmployees(data.employees);
    setTotalCount(data.total);
    setCurrentPage(data.page);
  }
};
```

---

## 6. データ構造

### 6.1 State管理
```typescript
interface EmployeeListState {
  employees: Employee[];
  totalCount: number;
  currentPage: number;
  itemsPerPage: number;
  searchTerm: string;
  selectedDepartment: string;
  selectedStatus: string;
  isLoading: boolean;
  error: string | null;
  sortBy: string;
  sortOrder: 'asc' | 'desc';
}

interface Employee {
  employee_id: string;
  full_name: string;
  email: string;
  phone?: string;
  department: string;
  position: string;
  status: 'active' | 'inactive' | 'on_leave';
  skill: string[];
  join_date: string;
}
```

### 6.2 初期値
```typescript
const initialState: EmployeeListState = {
  employees: [],
  totalCount: 0,
  currentPage: 1,
  itemsPerPage: 20,
  searchTerm: '',
  selectedDepartment: '',
  selectedStatus: '',
  isLoading: true,
  error: null,
  sortBy: 'employee_id',
  sortOrder: 'asc'
};
```

---

## 7. 検索・フィルタ機能

### 7.1 検索仕様
| 検索対象          | 検索方式              | 備考                    |
|-------------------|----------------------|-------------------------|
| 氏名              | 部分一致              | ひらがな・カタカナ対応  |
| メールアドレス    | 部分一致              | @マーク含む             |
| 社員ID            | 前方一致              | 英数字                  |

### 7.2 フィルタ仕様
#### 部門フィルタ
```typescript
const departmentOptions = [
  { value: '', label: '全て' },
  { value: '開発部', label: '開発部' },
  { value: '営業部', label: '営業部' },
  { value: '管理部', label: '管理部' },
  { value: '人事部', label: '人事部' }
];
```

#### ステータスフィルタ
```typescript
const statusOptions = [
  { value: '', label: '全て' },
  { value: 'active', label: '稼働中' },
  { value: 'inactive', label: '非稼働' },
  { value: 'on_leave', label: '休職中' }
];
```

### 7.3 リアルタイム検索
- 入力値変更から500msの遅延でAPI呼び出し
- debounce機能により連続入力時のAPI呼び出し削減

---

## 8. ソート機能

### 8.1 ソート対象カラム
| カラム名          | ソート方式            | デフォルト              |
|-------------------|----------------------|-------------------------|
| 社員ID            | 英数字順              | 昇順                    |
| 氏名              | 五十音順              | 昇順                    |
| 部門              | 文字列順              | 昇順                    |
| 入社日            | 日付順                | 降順（新しい順）        |

### 8.2 ソート状態表示
```typescript
const SortIcon = ({ column, currentSort, currentOrder }) => {
  if (currentSort !== column) return <UnfoldMoreIcon />;
  return currentOrder === 'asc' ? <KeyboardArrowUpIcon /> : <KeyboardArrowDownIcon />;
};
```

---

## 9. ページネーション

### 9.1 ページネーション仕様
- **1ページあたり**: 20件（固定）
- **最大ページ数**: 自動計算
- **表示範囲**: 現在ページ ± 2ページ

### 9.2 ページ表示制御
```typescript
const calculateVisiblePages = (current: number, total: number) => {
  const range = 2;
  const start = Math.max(1, current - range);
  const end = Math.min(total, current + range);
  
  return Array.from({ length: end - start + 1 }, (_, i) => start + i);
};
```

---

## 10. エラーハンドリング

### 10.1 エラーパターン
| エラー種別        | 表示内容                    | 対処法                    |
|-------------------|----------------------------|---------------------------|
| データ取得失敗    | "社員データの取得に失敗"    | 再読み込みボタン表示      |
| 検索エラー        | "検索処理でエラーが発生"    | 検索条件リセット          |
| 認証エラー        | "認証が切れました"          | ログイン画面リダイレクト  |
| ネットワークエラー| "ネットワークエラー"        | オフライン表示            |

### 10.2 ローディング状態
```typescript
{isLoading && (
  <Box display="flex" justifyContent="center" p={4}>
    <CircularProgress />
    <Typography variant="body2" sx={{ ml: 2 }}>
      読み込み中...
    </Typography>
  </Box>
)}
```

### 10.3 空データ状態
```typescript
{employees.length === 0 && !isLoading && (
  <Box textAlign="center" p={4}>
    <PersonIcon sx={{ fontSize: 48, color: 'grey.400' }} />
    <Typography variant="h6" color="textSecondary">
      社員データがありません
    </Typography>
    <Button variant="contained" onClick={() => router.push('/employees/add')}>
      最初の社員を登録
    </Button>
  </Box>
)}
```

---

## 11. パフォーマンス最適化

### 11.1 メモ化
```typescript
// 検索結果のメモ化
const filteredEmployees = useMemo(() => {
  return employees.filter(emp => {
    const matchesSearch = !searchTerm || 
      emp.full_name.includes(searchTerm) ||
      emp.email.includes(searchTerm) ||
      emp.employee_id.includes(searchTerm);
    
    const matchesDepartment = !selectedDepartment || 
      emp.department === selectedDepartment;
    
    const matchesStatus = !selectedStatus || 
      emp.status === selectedStatus;
    
    return matchesSearch && matchesDepartment && matchesStatus;
  });
}, [employees, searchTerm, selectedDepartment, selectedStatus]);
```

### 11.2 仮想化
- 大量データ（1000件以上）の場合はreact-windowによる仮想化
- 表示領域外の行は非レンダリング

### 11.3 キャッシュ戦略
- React Query使用によるサーバーサイドキャッシュ
- ローカルストレージによる検索条件保存

---

## 12. アクセシビリティ

### 12.1 キーボード操作
| キー              | 動作                      |
|-------------------|---------------------------|
| Tab               | フォーカス移動            |
| Enter             | ボタン実行・検索実行      |
| Space             | チェックボックス切り替え  |
| ↑↓               | テーブル行移動            |

### 12.2 スクリーンリーダー対応
```typescript
<TextField
  label="社員検索"
  aria-label="氏名、メールアドレス、社員IDで検索"
  aria-describedby="search-help"
/>
<div id="search-help" className="sr-only">
  氏名、メールアドレス、社員IDで部分一致検索できます
</div>
```

---

## 13. テスト仕様

### 13.1 単体テスト
- 検索機能テスト
- フィルタ機能テスト
- ソート機能テスト
- ページネーションテスト

### 13.2 統合テスト
- API連携テスト
- 画面遷移テスト
- エラーハンドリングテスト

### 13.3 E2Eテスト
```typescript
// 検索機能のE2Eテスト例
test('社員検索機能', async ({ page }) => {
  await page.goto('/employees');
  await page.fill('[data-testid="search-input"]', '田中');
  await page.click('[data-testid="search-button"]');
  await expect(page.locator('[data-testid="employee-list"]')).toContainText('田中太郎');
});
```

---

## チェックリスト
- [x] 検索・フィルタ機能定義完了
- [x] ページネーション仕様明記
- [x] ソート機能定義
- [x] API連携仕様詳細化
- [x] エラーハンドリング完備
- [x] パフォーマンス最適化考慮
- [x] アクセシビリティ対応
- [x] レスポンシブデザイン対応
- [x] テスト仕様策定