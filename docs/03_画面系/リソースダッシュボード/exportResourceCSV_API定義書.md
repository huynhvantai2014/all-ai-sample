# API定義書（IPA標準）

API名: exportResourceCSV
API ID: API_RESOURCE_EXPORT_001
エンドポイント: /api/resource/export/csv
HTTPメソッド: GET
関連画面: リソースダッシュボード

## 1. 機能概要
リソース状況データをCSV形式でエクスポートする。部門・期間による絞り込みが可能。

## 2. 入力パラメータ

| パラメータ名 | 必須 | データ型 | 桁数 | 説明 | 備考 |
|--------------|------|----------|------|------|------|
| department | △ | string | 50 | 部署名 | 全部署の場合は指定なし |
| period | △ | string | 20 | 期間 | monthly/weekly/daily |
| date_from | △ | string | - | 開始日 | YYYY-MM-DD形式 |
| date_to | △ | string | - | 終了日 | YYYY-MM-DD形式 |
| format | △ | string | 10 | 出力形式 | csv/excel（デフォルト：csv） |

## 3. 出力パラメータ

| フィールド名 | データ型 | 桁数 | 説明 | 備考 |
|--------------|----------|------|------|------|
| success | boolean | - | 処理成功フラグ | true/false |
| file_url | string | 500 | ダウンロードURL | 一時URL |
| file_name | string | 255 | ファイル名 | - |
| record_count | number | - | 出力件数 | - |
| expires_at | string | - | URL有効期限 | ISO8601形式 |

## 4. エラーコード・メッセージ

| エラーコード | メッセージ | 発生条件 |
|--------------|------------|----------|
| E701 | ファイル生成失敗 | CSVファイル生成エラー |
| E702 | データ取得失敗 | DB接続エラー等 |
| E703 | 権限不足 | エクスポート権限なし |
| E704 | 対象データなし | 条件に該当するデータなし |
| E999 | システムエラー | 予期しないエラー |

## 5. 処理フロー
1. 入力パラメータ検証
2. 権限チェック
3. リソースデータ取得
4. CSVファイル生成
5. 一時URL生成
6. レスポンス返却

## 6. セキュリティ・その他
- 管理者・一般社員のみエクスポート可能
- 一時URLは1時間で無効
- ファイルサイズ制限：50MB

## 7. テストケース
- 正常ケース: 各種条件でのエクスポート
- 異常ケース: 権限なし、対象データなし

## 8. 備考
- AIによる自動レポート生成機能付き（最大30%創造性）