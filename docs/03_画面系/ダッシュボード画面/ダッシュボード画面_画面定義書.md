# 画面定義書 - ダッシュボード画面

---

**画面名**：ダッシュボード画面
**画面ID**：SRC0012
**画面物理名**：dashboard
**URL**：/dashboard

## 画面で使用するAPI一覧

### API 1: ダッシュボードサマリー取得API

---
**API ID**: DASH001
**API名**: ダッシュボードサマリー取得
**エンドポイント**: /api/dashboard/summary
**メソッド**: GET

#### 1. 機能概要 (Tóm tắt chức năng)
- システム全体の状況・売上・在庫・ユーザー等のサマリー情報を取得する

#### 2. パラメータ定義 (Định nghĩa tham số)
| パラメータ名 | 種別 | 必須 | 型 | 桁数 | 説明 |
|--------------|------|------|----|------|------|
| period       | query |     | string | 10 | 集計期間（today/week/month） |
| storeId      | query |     | string | 20 | 店舗ID（指定店舗のみ） |

#### 3. レスポンス定義 (Định nghĩa response)
| フィールド名 | 型 | 桁数 | 説明 |
|--------------|----|------|------|
| salesSummary | object | - | 売上サマリー |
| salesSummary.todaySales | number | 12,2 | 本日売上 |
| salesSummary.weekSales | number | 12,2 | 週間売上 |
| salesSummary.monthSales | number | 12,2 | 月間売上 |
| salesSummary.transactionCount | number | 10 | 取引数 |
| salesSummary.averageTransaction | number | 10,2 | 平均客単価 |
| inventorySummary | object | - | 在庫サマリー |
| inventorySummary.lowStockCount | number | 10 | 在庫不足商品数 |
| inventorySummary.outOfStockCount | number | 10 | 在庫切れ商品数 |
| inventorySummary.totalProducts | number | 10 | 総商品数 |
| orderSummary | object | - | 注文サマリー |
| orderSummary.pendingOrders | number | 10 | 未処理仮販売数 |
| orderSummary.expiringSoon | number | 10 | 期限間近注文数 |
| systemStatus | object | - | システム状況 |
| systemStatus.activeUsers | number | 10 | アクティブユーザー数 |
| systemStatus.onlineTerminals | number | 10 | オンライン端末数 |
| alerts       | array | - | アラート・通知リスト |
| alerts[].id  | string | 20 | アラートID |
| alerts[].type | string | 20 | アラート種別 |
| alerts[].message | string | 255 | メッセージ |
| alerts[].priority | string | 10 | 優先度 |
| alerts[].createdAt | datetime | - | 発生日時 |

#### 4. エラーコード・メッセージ (Mã lỗi, message)
| コード | メッセージ | 条件 |
|--------|------------|------|
| 400    | 無効な期間指定です | period値不正 |
| 500    | システムエラーが発生しました | サーバーエラー |

#### 5. 処理フロー (Luồng xử lý API)
- 1. 入力バリデーション (Validate đầu vào):
    - periodの値チェック
- 2. 相関バリデーション (Validate tương关/DB):
    - 店舗存在チェック（storeId指定時）
- 3. 業務処理 (Xử lý nghiệp vụ):
    - 売上データ集計（transactionsテーブル）
    - 在庫情報集計（stocks, productsテーブル）
    - 仮販売状況集計（provisional_ordersテーブル）
    - システム状況取得（user_sessions, terminalsテーブル）
    - アラート・通知取得（alertsテーブル）
- 4. レスポンス生成 (Trả kết quả):
    - 各種サマリー・アラート情報返却

#### 6. 備考 (Ghi chú)
- リアルタイム更新対応

### API 2: 売上推移データ取得API

---
**API ID**: DASH002
**API名**: 売上推移データ取得
**エンドポイント**: /api/dashboard/sales-trend
**メソッド**: GET

#### 1. 機能概要 (Tóm tắt chức năng)
- グラフ表示用の売上推移データを取得する

#### 2. パラメータ定義 (Định nghĩa tham số)
| パラメータ名 | 種別 | 必須 | 型 | 桁数 | 説明 |
|--------------|------|------|----|------|------|
| period       | query | ○   | string | 10 | 期間（7days/30days/3months） |
| storeId      | query |     | string | 20 | 店舗ID |

#### 3. レスポンス定義 (Định nghĩa response)
| フィールド名 | 型 | 桁数 | 説明 |
|--------------|----|------|------|
| chartData    | array | - | グラフデータ |
| chartData[].date | date | 10 | 日付 |
| chartData[].sales | number | 12,2 | 売上金額 |
| chartData[].transactions | number | 10 | 取引数 |
| summary      | object | - | 期間サマリー |
| summary.totalSales | number | 12,2 | 期間合計売上 |
| summary.averageDailySales | number | 12,2 | 日平均売上 |
| summary.growthRate | number | 6,2 | 前期比成長率（%） |

#### 4. エラーコード・メッセージ (Mã lỗi, message)
| コード | メッセージ | 条件 |
|--------|------------|------|
| 400    | 無効な期間指定です | period値不正 |
| 500    | システムエラーが発生しました | サーバーエラー |

#### 5. 処理フロー (Luồng xử lý API)
- 1. 入力バリデーション (Validate đầu vào):
    - periodの値チェック
- 2. 相関バリデーション (Validate tương关/DB):
    - 店舗存在チェック
- 3. 業務処理 (Xử lý nghiệp vụ):
    - 指定期間の売上データ取得・集計
    - 日別グラフデータ生成
    - 前期比較・成長率計算
- 4. レスポンス生成 (Trả kết quả):
    - グラフデータ・サマリー返却

#### 6. 備考 (Ghi chú)
- 前期比較機能

### API 3: 在庫アラート取得API

---
**API ID**: DASH003
**API名**: 在庫アラート取得
**エンドポイント**: /api/dashboard/inventory-alerts
**メソッド**: GET

#### 1. 機能概要 (Tóm tắt chức năng)
- 在庫不足・在庫切れ商品のアラート情報を取得する

#### 2. パラメータ定義 (Định nghĩa tham số)
| パラメータ名 | 種別 | 必須 | 型 | 桁数 | 説明 |
|--------------|------|------|----|------|------|
| severity     | query |     | string | 10 | 深刻度（critical/warning） |
| limit        | query |     | number | 3  | 取得件数 |

#### 3. レスポンス定義 (Định nghĩa response)
| フィールド名 | 型 | 桁数 | 説明 |
|--------------|----|------|------|
| alerts       | array | - | 在庫アラートリスト |
| alerts[].productId | string | 20 | 商品ID |
| alerts[].productName | string | 255 | 商品名 |
| alerts[].sku | string | 50 | SKU |
| alerts[].currentStock | number | 10 | 現在在庫数 |
| alerts[].minimumStock | number | 10 | 最小在庫数 |
| alerts[].severity | string | 10 | 深刻度 |
| alerts[].daysOutOfStock | number | 10 | 在庫切れ日数 |
| summary      | object | - | アラートサマリー |
| summary.criticalCount | number | 10 | 緊急アラート数 |
| summary.warningCount | number | 10 | 警告アラート数 |

#### 4. エラーコード・メッセージ (Mã lỗi, message)
| コード | メッセージ | 条件 |
|--------|------------|------|
| 500    | システムエラーが発生しました | サーバーエラー |

#### 5. 処理フロー (Luồng xử lý API)
- 1. 入力バリデーション (Validate đầu vào):
    - パラメータ値チェック
- 2. 相関バリデーション (Validate tương关/DB):
    - なし
- 3. 業務処理 (Xử lý nghiệp vụ):
    - stocks, productsテーブルから在庫状況取得
    - 最小在庫数との比較
    - 深刻度判定・並び替え
- 4. レスポンス生成 (Trả kết quả):
    - 在庫アラート・サマリー返却

#### 6. 備考 (Ghi chú)
- 最小在庫数設定機能

---

## 関連テーブル

- **transactions**: 取引記録
- **provisional_orders**: 仮販売
- **products**: 商品マスタ
- **stocks**: 在庫情報
- **users**: ユーザー情報
- **user_sessions**: ユーザーセッション
- **terminals**: POS端末情報
- **alerts**: アラート・通知