# API定義書
## HR Management System - 人材管理システム

### バージョン: 1.0.0
### 最終更新日: 2025年10月30日

---

## 1. API一覧

| API ID          | API名                  | エンドポイント                    | メソッド | 機能概要                          | 備考                     |
|-----------------|------------------------|-----------------------------------|----------|-----------------------------------|--------------------------|
| API_AUTH_001    | ユーザー認証           | /api/auth/login                   | POST     | JWT認証、ログイン処理             | 全ユーザー対象           |
| API_AUTH_002    | ユーザー情報取得       | /api/auth/userinfo                | GET      | 認証済みユーザー情報取得          | JWT必須                  |
| API_EMP_001     | 社員検索               | /api/employee/search              | GET      | 社員一覧取得、検索・フィルタ      | ページネーション対応     |
| API_EMP_002     | 社員詳細取得           | /api/employee/detail/[id]         | GET      | 個別社員の詳細情報取得            | Dynamic Route            |
| API_EMP_003     | 社員登録               | /api/employee/add                 | POST     | 新規社員情報登録                  | 重複チェック実装         |
| API_EMP_004     | 社員更新               | /api/employee/update/[id]         | PUT      | 既存社員情報更新                  | Dynamic Route            |
| API_RES_001     | リソース状況取得       | /api/resource/status              | GET      | 部門別リソース状況、統計情報      | ダッシュボード用         |

---

## 2. API詳細仕様

### API_AUTH_001: ユーザー認証
**エンドポイント:** `/api/auth/login`  
**メソッド:** POST  
**業務機能:** JWT認証、ログイン処理、セッション開始

#### リクエストパラメータ
| パラメータ名 | 必須 | 型     | 説明                     | 例                |
|--------------|------|--------|--------------------------|-------------------|
| user_id      | ○    | string | ユーザーID               | "admin"           |
| password     | ○    | string | パスワード               | "123456"          |
| userType     | △    | string | テスト用ユーザー種別     | "admin"           |

#### レスポンス（成功時）
```json
{
  "success": true,
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user_id": "admin",
  "role": "admin",
  "expires_in": 3600
}
```

#### エラーレスポンス
| エラーコード | メッセージ                 | HTTPステータス | 条件                     |
|--------------|----------------------------|----------------|--------------------------|
| E001         | 認証失敗                   | 401            | ユーザーID・パスワード不一致 |
| E003         | 入力不備                   | 400            | 必須項目未入力           |
| E999         | システムエラー             | 500            | 予期しないエラー         |

#### 処理フロー
1. 入力検証（user_id, password必須）
2. ユーザー存在確認
3. パスワード検証（bcrypt）
4. JWTトークン生成
5. 最終ログイン日時更新

---

### API_AUTH_002: ユーザー情報取得
**エンドポイント:** `/api/auth/userinfo`  
**メソッド:** GET  
**業務機能:** 認証済みユーザーの詳細情報取得

#### リクエストヘッダー
| ヘッダー名    | 必須 | 説明               |
|---------------|------|--------------------|
| Authorization | ○    | Bearer {JWT_TOKEN} |

#### レスポンス（成功時）
```json
{
  "success": true,
  "user_id": "admin",
  "role": "admin",
  "last_login": "2025-10-30T12:00:00Z"
}
```

#### エラーレスポンス
| エラーコード | メッセージ     | HTTPステータス | 条件                 |
|--------------|----------------|----------------|----------------------|
| E401         | 認証失敗       | 401            | トークン無効・期限切れ |

---

### API_EMP_001: 社員検索
**エンドポイント:** `/api/employee/search`  
**メソッド:** GET  
**業務機能:** 社員一覧取得、検索・フィルタリング機能

#### クエリパラメータ
| パラメータ名 | 必須 | 型     | 説明               | 例              |
|--------------|------|--------|--------------------|-----------------|
| search       | △    | string | 検索キーワード     | "田中"          |
| department   | △    | string | 部門フィルタ       | "開発部"        |
| status       | △    | string | ステータスフィルタ | "active"        |
| page         | △    | number | ページ番号         | 1               |
| limit        | △    | number | 取得件数           | 20              |

#### レスポンス（成功時）
```json
{
  "success": true,
  "employees": [
    {
      "employee_id": "EMP001",
      "full_name": "田中太郎",
      "email": "tanaka@example.com",
      "phone": "090-1234-5678",
      "department": "開発部",
      "position": "エンジニア",
      "status": "active",
      "skill": ["JavaScript", "Python"],
      "join_date": "2023-04-01T00:00:00Z"
    }
  ],
  "total": 100,
  "page": 1,
  "limit": 20
}
```

#### エラーレスポンス
| エラーコード | メッセージ     | HTTPステータス | 条件             |
|--------------|----------------|----------------|------------------|
| E401         | 認証失敗       | 401            | JWT認証失敗      |
| E500         | システムエラー | 500            | DB接続エラーなど |

---

### API_EMP_002: 社員詳細取得
**エンドポイント:** `/api/employee/detail/[employee_id]`  
**メソッド:** GET  
**業務機能:** 個別社員の詳細情報取得

#### パスパラメータ
| パラメータ名 | 必須 | 型     | 説明     | 例      |
|--------------|------|--------|----------|---------|
| employee_id  | ○    | string | 社員ID   | "EMP001"|

#### レスポンス（成功時）
```json
{
  "success": true,
  "employee_id": "EMP001",
  "full_name": "田中太郎",
  "email": "tanaka@example.com",
  "phone": "090-1234-5678",
  "department": "開発部",
  "position": "エンジニア",
  "status": "active",
  "skill": ["JavaScript", "Python", "React"],
  "join_date": "2023-04-01T00:00:00Z",
  "created_at": "2023-03-15T00:00:00Z",
  "updated_at": "2025-10-30T00:00:00Z"
}
```

#### エラーレスポンス
| エラーコード | メッセージ             | HTTPステータス | 条件             |
|--------------|------------------------|----------------|------------------|
| E301         | 社員情報が存在しません | 404            | 社員ID不存在     |
| E302         | データ取得失敗         | 500            | DB接続エラーなど |

---

### API_EMP_003: 社員登録
**エンドポイント:** `/api/employee/add`  
**メソッド:** POST  
**業務機能:** 新規社員情報登録、重複チェック

#### リクエストボディ
```json
{
  "employee_id": "EMP999",
  "full_name": "佐藤花子",
  "email": "sato@example.com",
  "phone": "090-9876-5432",
  "department": "営業部",
  "position": "営業",
  "status": "active",
  "skill": ["営業", "Excel"],
  "join_date": "2025-10-30T00:00:00Z"
}
```

#### バリデーション
| フィールド名 | 必須 | 型     | 制約                         |
|--------------|------|--------|------------------------------|
| employee_id  | ○    | string | 20文字以内、重複チェック     |
| full_name    | ○    | string | 100文字以内                  |
| email        | ○    | string | メール形式、重複チェック     |
| phone        | △    | string | 電話番号形式                 |
| department   | ○    | string | 50文字以内                   |
| position     | ○    | string | 50文字以内                   |
| status       | ○    | string | active/inactive/on_leave     |
| skill        | △    | array  | 文字列配列                   |
| join_date    | ○    | string | ISO8601形式                  |

#### レスポンス（成功時）
```json
{
  "success": true,
  "employee_id": "EMP999",
  "full_name": "佐藤花子",
  "email": "sato@example.com",
  "message": "社員登録が完了しました"
}
```

#### エラーレスポンス
| エラーコード | メッセージ                       | HTTPステータス | 条件                     |
|--------------|----------------------------------|----------------|--------------------------|
| E301         | 必須項目が入力されていません     | 400            | 必須項目未入力           |
| E302         | この社員IDは既に使用されています | 400            | 社員ID重複               |
| E303         | このメールアドレスは既に使用されています | 400    | メール重複               |
| E304         | この電話番号は既に使用されています | 400            | 電話番号重複             |
| E305         | データの形式が正しくありません   | 400            | バリデーションエラー     |

---

### API_EMP_004: 社員更新
**エンドポイント:** `/api/employee/update/[employee_id]`  
**メソッド:** PUT  
**業務機能:** 既存社員情報更新、重複チェック

#### パスパラメータ
| パラメータ名 | 必須 | 型     | 説明     | 例      |
|--------------|------|--------|----------|---------|
| employee_id  | ○    | string | 社員ID   | "EMP001"|

#### リクエストボディ
```json
{
  "full_name": "田中太郎",
  "email": "tanaka.new@example.com",
  "phone": "090-1111-2222",
  "department": "開発部",
  "position": "シニアエンジニア",
  "status": "active",
  "skill": ["JavaScript", "Python", "React", "Node.js"],
  "join_date": "2023-04-01T00:00:00Z"
}
```

#### レスポンス（成功時）
```json
{
  "success": true,
  "employee_id": "EMP001",
  "full_name": "田中太郎",
  "email": "tanaka.new@example.com",
  "updated_at": "2025-10-30T12:00:00Z"
}
```

#### エラーレスポンス
| エラーコード | メッセージ                       | HTTPステータス | 条件                     |
|--------------|----------------------------------|----------------|--------------------------|
| E201         | 必須項目が入力されていません     | 400            | 必須項目未入力           |
| E202         | このメールアドレスは既に使用されています | 400    | メール重複（自分以外）   |
| E203         | 社員情報が存在しません           | 404            | 対象社員不存在           |
| E204         | データの形式が正しくありません   | 400            | バリデーションエラー     |

---

### API_RES_001: リソース状況取得
**エンドポイント:** `/api/resource/status`  
**メソッド:** GET  
**業務機能:** 部門別リソース状況、プロジェクト情報取得

#### レスポンス（成功時）
```json
{
  "success": true,
  "summary": {
    "total_employees": 50,
    "active_employees": 45,
    "available_employees": 10,
    "utilization_rate": 80
  },
  "departments": [
    {
      "department_name": "開発部",
      "total_count": 20,
      "active_count": 18,
      "available_count": 5,
      "utilization_rate": 90
    }
  ],
  "projects": [
    {
      "project_name": "新商品開発",
      "member_count": 8
    }
  ]
}
```

#### エラーレスポンス
| エラーコード | メッセージ     | HTTPステータス | 条件             |
|--------------|----------------|----------------|------------------|
| E401         | 認証失敗       | 401            | JWT認証失敗      |
| E500         | システムエラー | 500            | DB接続エラーなど |

---

## 3. 共通仕様

### 3.1 認証方式
- **JWT（JSON Web Token）**認証を使用
- トークンの有効期限: 1時間
- リフレッシュトークン: 未実装（将来実装予定）

### 3.2 リクエストヘッダー
```
Authorization: Bearer {JWT_TOKEN}
Content-Type: application/json
```

### 3.3 エラーレスポンス形式
```json
{
  "success": false,
  "error": "エラーコード",
  "message": "エラーメッセージ"
}
```

### 3.4 HTTPステータスコード
| ステータス | 説明                   | 使用例                 |
|------------|------------------------|------------------------|
| 200        | 成功                   | 正常処理完了           |
| 400        | リクエストエラー       | バリデーションエラー   |
| 401        | 認証エラー             | JWT認証失敗            |
| 404        | リソースが見つからない | 社員ID不存在           |
| 500        | サーバーエラー         | DB接続エラー           |

### 3.5 データ型定義
- **日付形式**: ISO 8601 (例: "2025-10-30T12:00:00Z")
- **文字エンコーディング**: UTF-8
- **タイムゾーン**: UTC

---

## 4. セキュリティ仕様

### 4.1 認証・認可
- JWTトークンによる認証
- ロールベースアクセス制御（RBAC）
- パスワードハッシュ化（bcryptjs）

### 4.2 データ保護
- HTTPSでの通信（本番環境）
- SQLインジェクション対策（Mongoose ODM使用）
- XSS対策（入力値サニタイズ）

### 4.3 レート制限
- API呼び出し頻度制限（将来実装予定）
- ブルートフォース攻撃対策（将来実装予定）

---

## 5. 技術仕様

### 5.1 フレームワーク・ライブラリ
- **Next.js 16**: API Routes
- **MongoDB**: データベース
- **Mongoose**: ODM
- **jsonwebtoken**: JWT認証
- **bcryptjs**: パスワードハッシュ化

### 5.2 開発・テスト環境
- **開発サーバー**: http://localhost:3001
- **データベース**: MongoDB localhost:27017
- **テストデータ**: seeded sample data

---

## 6. API開発ガイドライン

### 6.1 命名規則
- エンドポイント: kebab-case（例: /api/employee/search）
- パラメータ: snake_case（例: employee_id）
- レスポンスフィールド: snake_case

### 6.2 エラーハンドリング
- 統一されたエラーレスポンス形式
- 適切なHTTPステータスコード
- ユーザーフレンドリーなエラーメッセージ

### 6.3 ログ出力
- APIアクセスログ
- エラーログ（console.error）
- パフォーマンスログ（将来実装予定）

---

## 7. 今後の拡張予定

### 7.1 新機能API
- ファイルアップロードAPI（CSV/Excelインポート）
- バッチ処理API（一括更新）
- レポート生成API
- 通知API

### 7.2 パフォーマンス改善
- キャッシュ機能
- ページネーション最適化
- データベースインデックス最適化

### 7.3 セキュリティ強化
- リフレッシュトークン実装
- API レート制限
- 監査ログ機能

---

## チェックリスト
- [x] 実装済みAPIの完全な文書化
- [x] エラーコード・メッセージの統一
- [x] セキュリティ仕様の明記
- [x] リクエスト・レスポンス例の提供
- [x] バリデーション仕様の詳細化
- [x] 将来拡張予定の明記